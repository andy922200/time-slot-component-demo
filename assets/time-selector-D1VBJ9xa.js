import"./index-CSaXsr8O.js";import{a as c}from"./index-BN4XCwYM.js";const w=({isNow:i,targetDate:a,timeSector:t,nowDayjs:r,startTime:l})=>{if(i){const n=r.minute()%t;return r.subtract(n,"minute").second(0).startOf("second")}else return E({dateStr:a,timeStr:l})},M=({allTimeSlots:i,targetDate:a,startTimeDayjs:t,nextDayHintKey:r})=>{const l=[];let d=!1;for(const n of i){let s=E({dateStr:a,timeStr:n.slotStart});if(n.slotEnd==="00:00"&&(s=s.add(1,"day")),s.isSameOrAfter(t)){if(n.isOverlap){d=!0;break}l.push({originalObj:n,label:n.slotEnd==="00:00"?`00:00_${r}`:n.slotEnd,value:n.slotEnd})}}return{endTimeOptions:l,sameDayBreak:d}},j=({startTimeDayjs:i,maxUsageHours:a,usedTimeSlots:t,timeSector:r,targetDate:l,nextDayHintKey:d,dateFormat:n="YYYY-MM-DD",timeFormat:s="HH:mm"})=>{const u=[],e=c(l).add(1,"day").format(`${n}`),f=t.filter(o=>o.date===e),$=i.add(a,"hour");let S=c(`${e} 00:00`,`${n} ${s}`);const Y=f.length>0?f.reduce((o,O)=>{const m=E({dateStr:e,timeStr:O.startTime}),p=m.minute(Math.floor(m.minute()/r)*r).second(0);return p.isBefore(o)?p:o},c(`${e} 24:00`,`${n} ${s}`)):c(`${e} 24:00`,`${n} ${s}`),y=Y.isBefore($)?Y:$;for(;S.isBefore(y);){const o=S.add(r,"minute");u.push({originalObj:{slotStart:S.format(`${s}`),slotEnd:o.format(`${s}`),date:e},label:`${o.format(`${s}`)}_${d}`,value:o.format(`${s}`)}),S=o}return u},T=({endTimeOptions:i,startTimeDayjs:a,minUsageHours:t,maxUsageHours:r,isNow:l=!1,nowDayjs:d,dateFormat:n="YYYY-MM-DD",timeFormat:s="HH:mm"})=>{const u=(e,f)=>{const S=e.diff(f,"minute")/60;return S>=t&&S<=r};return i.filter(e=>{let f=c(`${e.originalObj.date} ${e.value}`,`${n} ${s}`);return e.originalObj.slotEnd==="00:00"&&(f=f.add(1,"day")),u(f,l?d:a)})};function D({startTime:i,endTime:a,date:t,slotStart:r,slotEnd:l,slotDate:d,dateFormat:n="YYYY-MM-DD",timeFormat:s="HH:mm"}){const u=c(`${t} ${i}`,`${n} ${s}`);let e=c(`${t} ${a}`,`${n} ${s}`);a==="00:00"&&e.isBefore(u)&&(e=e.add(1,"day"));const f=c(`${d} ${r}`,`${n} ${s}`);let $=c(`${d} ${l}`,`${n} ${s}`);return l==="00:00"&&$.isBefore(f)&&($=$.add(1,"day")),u.isBefore($)&&e.isAfter(f)}function b({timeSlots:i,usedTimeSlots:a,targetDate:t,dateFormat:r="YYYY-MM-DD",timeFormat:l="HH:mm"}){const d=c();i.forEach(n=>{let s=!1;a.forEach(({startTime:f,endTime:$,date:S})=>{D({startTime:f,endTime:$,date:S,slotStart:n.slotStart,slotEnd:n.slotEnd,slotDate:t})&&(s=!0)}),n.isOverlap=s;let u=c(`${t} ${n.slotEnd}`,`${r} ${l}`);n.slotEnd==="00:00"&&(u=u.add(1,"day"));const e=u.isBefore(d);n.isPast=e})}function v({targetDate:i,timeSector:a,dateFormat:t="YYYY-MM-DD",timeFormat:r="HH:mm"}){const l=[];let d=c(`${i} 00:00`,`${t} ${r}`);const n=c(`${i} 24:00`,`${t} ${r}`);for(;d.isBefore(n);){const s=d.add(a,"minute");l.push({slotStart:d.format(`${r}`),slotEnd:s.format(`${r}`),isOverlap:!1,isPast:!1,date:i}),d=s}return l}function E({dateStr:i,timeStr:a,dateFormat:t="YYYY-MM-DD",timeFormat:r="HH:mm"}){return c(`${i} ${a}`,`${t} ${r}`).startOf("second")}function B({allTimeSlots:i,targetDate:a,usedTimeSlots:t,isNowActive:r=!0,timeSector:l,dateFormat:d="YYYY-MM-DD",timeFormat:n="HH:mm"}){const s=c().format(`${d}`),u=c().second(0).startOf("second");if(!a||c(a).isBefore(u,"day"))return[];const e=i.filter(o=>a===s?c(`${a} ${o.slotStart}`,`${d} ${n}`).second(0).startOf("second").isSameOrAfter(u):!0).filter(o=>!o.isOverlap).map(o=>({originalObj:o,label:o.slotStart,value:o.slotStart,isNow:!1,fullString:`${o.date}_${o.slotStart}-${o.slotEnd}`})),f=u.format(`${n}`),$=u.minute(),S=u.add(l-$%l,"minute").second(0).startOf("second").format(`${n}`),Y=t.some(({startTime:o,endTime:O,date:m})=>m===s?D({startTime:o,endTime:O,date:m,slotStart:f,slotEnd:S,slotDate:s}):!1),y=e.some(o=>o.value===f);return r&&a===s&&!Y&&!y&&e.unshift({label:"now",value:"Now",originalObj:{slotStart:f,slotEnd:S,date:s},isNow:!0,fullString:`${s}_${f}-${S}`}),e}function N({startTime:i,allTimeSlots:a,targetDate:t,usedTimeSlots:r,maxUsageHours:l=24,minUsageHours:d=0,timeSector:n,generateCrossDay:s=!0,nextDayHintKey:u="next-day",dateFormat:e="YYYY-MM-DD",timeFormat:f="HH:mm"}){const $=c(),S=i==="Now";if(!t||!i||c(t).isBefore($,"day")||c(t).isAfter($,"day")&&S)return[];const Y=w({isNow:i==="Now",targetDate:t,timeSector:n,nowDayjs:$,startTime:i}),{endTimeOptions:y,sameDayBreak:o}=M({allTimeSlots:a,targetDate:t,startTimeDayjs:Y,nextDayHintKey:u});if(s&&!o){const O=j({startTimeDayjs:Y,maxUsageHours:l,usedTimeSlots:r,timeSector:n,targetDate:t,nextDayHintKey:u,dateFormat:e,timeFormat:f});y.push(...O)}return T({endTimeOptions:y,startTimeDayjs:Y,minUsageHours:d,maxUsageHours:l,isNow:i==="Now",nowDayjs:$,dateFormat:e,timeFormat:f})}export{B as a,N as b,b as c,v as g,D as i};
